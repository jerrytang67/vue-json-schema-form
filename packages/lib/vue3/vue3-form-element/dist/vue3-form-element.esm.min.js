/** @license @ttwork/vue3-form-element (c) 2020-2021 JerryTang License: Apache-2.0 */
import{resolveComponent as e,openBlock as t,createBlock as o,withCtx as r,Fragment as l,renderList as n,createTextVNode as a,toDisplayString as i,h as s,ref as u,watch as d,getCurrentInstance as m,defineComponent as p,onMounted as c}from"vue";import f from"@ttwork/vue3-form-core";export{SchemaField,fieldProps}from"@ttwork/vue3-form-core";export{default as i18n}from"@ttwork/vjsf-utils/i18n";import{resolveComponent as g}from"@ttwork/vjsf-utils/vue3Utils";import*as v from"@ttwork/vjsf-utils/vue3Utils";export{v as vueUtils};import*as y from"@ttwork/vjsf-utils/formUtils";export{y as formUtils};import*as k from"@ttwork/vjsf-utils/schema/validate";export{k as schemaValidate};export{default as getDefaultFormState}from"@ttwork/vjsf-utils/schema/getDefaultFormState";import{parseDateString as b,openNewPage as h}from"@ttwork/vjsf-utils/utils";var x={name:"CheckboxesWidget",props:{enumOptions:{default:()=>[],type:[Array]}}};x.render=function(s,u,d,m,p,c){const f=e("el-checkbox"),g=e("el-checkbox-group");return t(),o(g,s.$attrs,{default:r(()=>[(t(!0),o(l,null,n(d.enumOptions,(e,l)=>(t(),o(f,{key:l,label:e.value},{default:r(()=>[a(i(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},16)},x.__file="src/config/widgets/CheckboxesWidget/index.vue";var W={name:"RadioWidget",props:{enumOptions:{default:()=>[],type:[Array]}}};W.render=function(s,u,d,m,p,c){const f=e("el-radio"),g=e("el-radio-group");return t(),o(g,s.$attrs,{default:r(()=>[(t(!0),o(l,null,n(d.enumOptions,(e,l)=>(t(),o(f,{key:l,label:e.value},{default:r(()=>[a(i(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},16)},W.__file="src/config/widgets/RadioWidget/index.vue";var w={name:"SelectWidget",props:{enumOptions:{default:()=>[],type:[Array]}}};function S(e){return null===e||""===e||Array.isArray(e)&&e.every(e=>""===e)}w.render=function(a,i,s,u,d,m){const p=e("el-option"),c=e("el-select");return t(),o(c,a.$attrs,{default:r(()=>[(t(!0),o(l,null,n(s.enumOptions,(e,r)=>(t(),o(p,{key:r,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},16)},w.__file="src/config/widgets/SelectWidget/index.vue";const V=e=>{const{year:t,month:o,day:r}=b(e,!1);return`${t}-${o}-${r}`};const D=e=>{if(e instanceof Date)return e;if("string"==typeof e){const[t,o,r]=e.split(":"),l=new Date;return l.setHours(+t),l.setMinutes(+o),l.setSeconds(+r),l}};const P={CheckboxesWidget:x,RadioWidget:W,SelectWidget:w,TimePickerWidget:{name:"TimePickerWidget",inheritAttrs:!1,props:{modelValue:{default:null,type:null}},setup(e,{attrs:t,slots:o}){const r=u(D(e.modelValue));let l=e.modelValue;return d(()=>e.modelValue,e=>{e!==l&&(r.value=D(e))}),()=>s(g("el-time-picker"),{...t,modelValue:r.value,"onUpdate:modelValue":e=>{r.value=e,l=null===e?void 0:(e=>{const{hour:t,minute:o,second:r}=b(e,!0);return`${t}:${o}:${r}`})(e),t["onUpdate:modelValue"].apply(t,[l])}},o)}},DatePickerWidget:{name:"DatePickerWidget",inheritAttrs:!1,setup:(e,{attrs:t,slots:o})=>()=>{const{isNumberValue:e,isRange:r,...l}=t||{};return s(g("el-date-picker"),{type:r?"daterange":"date",...l,"onUpdate:modelValue":o=>{let l;l=r?S(o)?[]:o.map(t=>e?new Date(t).valueOf():V(t)):S(o)?void 0:e?new Date(o).valueOf():V(o),t["onUpdate:modelValue"].apply(t,[l])}},o)}},DateTimePickerWidget:{name:"DateTimePickerWidget",inheritAttrs:!1,setup:(e,{attrs:t,slots:o})=>()=>{const{isNumberValue:e,isRange:r,...l}=t||{};return s(g("el-date-picker"),{type:r?"datetimerange":"datetime",...l,"onUpdate:modelValue":o=>{const l=((e,t,o)=>e?null===o?[]:o.map(e=>new Date(e)[t?"valueOf":"toISOString"]()):null===o?void 0:new Date(o)[t?"valueOf":"toISOString"]())(r,e,o);t["onUpdate:modelValue"].apply(t,[l])}},o)}},UploadWidget:{name:"UploadWidget",props:{modelValue:{default:null,type:[String,Array]},responseFileUrl:{default:()=>e=>e?e.url||e.data&&e.data.url:"",type:[Function]},btnText:{type:String,default:"点击上传"},slots:{type:null,default:null}},setup(e,{attrs:t,emit:o}){const r=e.modelValue,l=Array.isArray(r),n=t.fileList||(l?r.map((e,t)=>({name:`已上传文件（${t+1}）`,url:e})):r?[{name:"已上传文件",url:r}]:[]),a=u(n),i=t=>t&&(t.response&&e.responseFileUrl(t.response)||t.url)||"",d=e=>{let t;if(l)t=e.length?e.reduce((e,t)=>{const o=i(t);return o&&e.push(o),e},[]):[];else{const o=e[e.length-1];t=i(o)}o("update:modelValue",t)},p=m().appContext.config.globalProperties;return()=>{const o={fileList:a.value,"on-exceed":()=>{p.$message&&p.$message.warning("超出文件上传数")},"on-error":()=>{p.$message&&p.$message.error("文件上传失败")},"on-preview":e=>{const t=i(e);t&&h(t)},...t,"on-remove":(e,o)=>{d(o),t["on-remove"]&&t["on-remove"](e,o)},"on-success":(e,o,r)=>{d(r),t["on-success"]&&t["on-success"](e,o,r)}};l||(o.limit=1);const r={default:()=>s(g("el-button"),{type:"primary"},{default:()=>e.btnText}),...e.slots||{}};return s(g("el-upload"),o,r)}}}},{CheckboxesWidget:A,RadioWidget:C,SelectWidget:_,TimePickerWidget:O,DatePickerWidget:$,DateTimePickerWidget:T}=P;var U={types:{boolean:"el-switch",string:"el-input",number:"el-input-number",integer:"el-input-number"},formats:{color:"el-color-picker",time:O,date:$,"date-time":T},common:{select:_,radioGroup:C,checkboxGroup:A},widgetComponents:P};!function(e,t){void 0===t&&(t={});var o=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css","top"===o&&r.firstChild?r.insertBefore(l,r.firstChild):r.appendChild(l),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(document.createTextNode(e))}}(".genFromComponent.el-form--label-top .el-form-item__label{line-height:26px;padding-bottom:6px;font-size:14px}.genFromComponent .el-checkbox,.genFromComponent .el-color-picker{vertical-align:top}");const F={WIDGET_MAP:U,COMPONENT_MAP:{form:p({inheritAttrs:!1,setup(e,{attrs:t,slots:o}){const r=u(null);return t.setFormRef&&c(()=>{t.setFormRef(r.value)}),()=>{const{setFormRef:e,...l}=t;return s(g("el-form"),{ref:r,...l},o)}}}),formItem:"el-form-item",button:"el-button",popover:"el-popover"},HELPERS:{isMiniDes:e=>e&&["left","right"].includes(e.labelPosition)}},R=f(F);export default R;export{F as globalOptions};
